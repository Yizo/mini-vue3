{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandles.ts", "../src/reactive.ts"],
  "sourcesContent": ["export function isObject(value) {\r\n    return value !== null && typeof value === 'object'\r\n}", "export let activeEffect = undefined\r\n\r\nclass ReactiveEffect {\r\n    public active = true\r\n    public deps = []\r\n    public parent = undefined\r\n    constructor(public fn) {}\r\n    run(){\r\n        if(!this.active) {\r\n            return this.fn()\r\n        }\r\n        // \u6784\u5EFAtree\u6811\u7236\u5B50\u5173\u7CFB\r\n        try{\r\n            this.parent = activeEffect\r\n            activeEffect = this\r\n            return this.fn()\r\n        } finally {\r\n            activeEffect = this.parent\r\n            this.parent = undefined\r\n        }\r\n    }\r\n}\r\n\r\nexport function effect(fn){\r\n    const _effect = new ReactiveEffect(fn)\r\n    // \u9ED8\u8BA4\u6267\u884C\u4E00\u6B21\r\n    _effect.run()\r\n}\r\n\r\n/**\r\n * let mapping = {\r\n *     target: {\r\n *         key: [activeEffect]\r\n *     }\r\n * }\r\n * **/\r\n// \u8BB0\u5F55target\u5BF9\u8C61\u4E0Akey\u5C5E\u6027\u7684effect\r\nconst targetMap = new WeakMap()\r\n\r\n/**\r\n * \u4F9D\u8D56\u6536\u96C6\r\n * @param { object } target - \u5BF9\u8C61\r\n * @param { object|string } key  - \u5C5E\u6027\r\n * */\r\nexport function track(target, key) {\r\n    if(!activeEffect) {\r\n        return\r\n    }\r\n    // { target: { key: [activeEffect] } }\r\n    let depsMap = targetMap.get(target)\r\n    if(!depsMap) {\r\n        targetMap.set(target, depsMap = new Map())\r\n    }\r\n    // { key: [activeEffect] }\r\n    let dep = depsMap.get(key)\r\n    if(!dep) {\r\n        depsMap.set(key, dep = new Set())\r\n    }\r\n    let shouldTrack = dep.has(activeEffect)\r\n    if(shouldTrack) {\r\n        dep.add(activeEffect)\r\n        activeEffect.deps.push(dep)\r\n    }\r\n}", "import {ReactiveFlags} from \"./reactive\";\r\nimport {activeEffect} from \"./effect\";\r\n\r\nexport const mutableHandlers = {\r\n    get(target, key, receiver) {\r\n        if (ReactiveFlags.IS_REACTIVE === key) {\r\n            console.log(activeEffect, key)\r\n            return true\r\n        }\r\n        return Reflect.get(target, key, receiver)\r\n    },\r\n    set(target, key, value, receiver) {\r\n        console.log('set', activeEffect, key)\r\n        return Reflect.set(target, key, value, receiver)\r\n    }\r\n}", "import {isObject} from '@vue/shared'\r\nimport {mutableHandlers} from './baseHandles'\r\n\r\n// \u7F13\u5B58\u54CD\u5E94\u5BF9\u8C61\uFF0C\u907F\u514D\u518D\u6B21\u88AB\u4EE3\u7406\r\nconst reactiveMap = new WeakMap()\r\n\r\n\r\nexport const enum ReactiveFlags {\r\n    IS_REACTIVE = '__v_isReactive'\r\n}\r\n\r\nexport function reactive(target: object) {\r\n    // \u4E0D\u662F\u5BF9\u8C61\u76F4\u63A5\u8FD4\u56DE\r\n    if (!isObject(target)) {\r\n        return\r\n    }\r\n\r\n    // \u5728\u521B\u5EFA\u54CD\u5E94\u5F0F\u5BF9\u8C61\u65F6\u5148\u8FDB\u884C\u53D6\u503C\uFF0C\u770B\u662F\u5426\u5DF2\u7ECF\u4EE3\u7406\u8FC7\r\n    // \u6CA1\u88AB\u4EE3\u7406\u524D\u662F\u4E0D\u4F1A\u89E6\u53D1get\uFF0C\u4E0D\u4F1A\u8FDB\u5165\r\n    if (target[ReactiveFlags.IS_REACTIVE]) {\r\n        return target\r\n    }\r\n\r\n    // \u5982\u679C\u5DF2\u7ECF\u88AB\u4EE3\u7406\u540E\uFF0C\u76F4\u63A5\u8FD4\u56DE\u4EE3\u7406\u540E\u5BF9\u8C61\r\n    const exisitingProxy = reactiveMap.get(target)\r\n    if (exisitingProxy) {\r\n        return exisitingProxy\r\n    }\r\n\r\n    const proxy = new Proxy(target, mutableHandlers)\r\n    reactiveMap.set(target, proxy)\r\n    return proxy\r\n}"],
  "mappings": ";AAAO,SAAS,SAAS,OAAO;AAC5B,SAAO,UAAU,QAAQ,OAAO,UAAU;AAC9C;;;ACFO,IAAI,eAAe;AAE1B,IAAM,iBAAN,MAAqB;AAAA,EAIjB,YAAmB,IAAI;AAAJ;AAHnB,SAAO,SAAS;AAChB,SAAO,OAAO,CAAC;AACf,SAAO,SAAS;AAAA,EACQ;AAAA,EACxB,MAAK;AACD,QAAG,CAAC,KAAK,QAAQ;AACb,aAAO,KAAK,GAAG;AAAA,IACnB;AAEA,QAAG;AACC,WAAK,SAAS;AACd,qBAAe;AACf,aAAO,KAAK,GAAG;AAAA,IACnB,UAAE;AACE,qBAAe,KAAK;AACpB,WAAK,SAAS;AAAA,IAClB;AAAA,EACJ;AACJ;AAEO,SAAS,OAAO,IAAG;AACtB,QAAM,UAAU,IAAI,eAAe,EAAE;AAErC,UAAQ,IAAI;AAChB;AAUA,IAAM,YAAY,oBAAI,QAAQ;AAOvB,SAAS,MAAM,QAAQ,KAAK;AAC/B,MAAG,CAAC,cAAc;AACd;AAAA,EACJ;AAEA,MAAI,UAAU,UAAU,IAAI,MAAM;AAClC,MAAG,CAAC,SAAS;AACT,cAAU,IAAI,QAAQ,UAAU,oBAAI,IAAI,CAAC;AAAA,EAC7C;AAEA,MAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,MAAG,CAAC,KAAK;AACL,YAAQ,IAAI,KAAK,MAAM,oBAAI,IAAI,CAAC;AAAA,EACpC;AACA,MAAI,cAAc,IAAI,IAAI,YAAY;AACtC,MAAG,aAAa;AACZ,QAAI,IAAI,YAAY;AACpB,iBAAa,KAAK,KAAK,GAAG;AAAA,EAC9B;AACJ;;;AC5DO,IAAM,kBAAkB;AAAA,EAC3B,IAAI,QAAQ,KAAK,UAAU;AACvB,+CAAkC,KAAK;AACnC,cAAQ,IAAI,cAAc,GAAG;AAC7B,aAAO;AAAA,IACX;AACA,WAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,EAC5C;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAC9B,YAAQ,IAAI,OAAO,cAAc,GAAG;AACpC,WAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAAA,EACnD;AACJ;;;ACXA,IAAM,cAAc,oBAAI,QAAQ;AAGzB,IAAW,gBAAX,kBAAWA,mBAAX;AACH,EAAAA,eAAA,iBAAc;AADA,SAAAA;AAAA,GAAA;AAIX,SAAS,SAAS,QAAgB;AAErC,MAAI,CAAC,SAAS,MAAM,GAAG;AACnB;AAAA,EACJ;AAIA,MAAI,OAAO,qCAA4B;AACnC,WAAO;AAAA,EACX;AAGA,QAAM,iBAAiB,YAAY,IAAI,MAAM;AAC7C,MAAI,gBAAgB;AAChB,WAAO;AAAA,EACX;AAEA,QAAM,QAAQ,IAAI,MAAM,QAAQ,eAAe;AAC/C,cAAY,IAAI,QAAQ,KAAK;AAC7B,SAAO;AACX;",
  "names": ["ReactiveFlags"]
}
